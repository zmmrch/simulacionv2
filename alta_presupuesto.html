<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Alta de Presupuestos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ESTILOS GENERALES Y DEL WIZARD */
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2, h3, h4, h5 {
      text-align: center;
      color: #333;
    }
    p.explicacion {
      font-size: 14px;
      color: #555;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    /* Modal para prospecto */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal-content {
      background: #fff;
      width: 90%;
      max-width: 500px;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .modal-content input, .modal-content select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .modal-content button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: #69b6b1;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }
    .modal-content button:hover {
      background: #89c5c0;
    }
    /* Pantalla de selección de presupuesto */
    .select-type {
      text-align: center;
      margin: 40px 0;
    }
    .select-type button {
      padding: 15px 30px;
      font-size: 16px;
      margin: 10px 0;
      width: 100%;
      max-width: 300px;
      background: #69b6b1;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .select-type button:hover {
      background: #89c5c0;
    }
    /* Barra de progreso */
    .progressbar {
      list-style: none;
      display: flex;
      justify-content: space-between;
      counter-reset: step;
      margin: 20px 0;
      padding-left: 0;
    }
    .progressbar li {
      flex: 1;
      text-align: center;
      position: relative;
      font-size: 14px;
      text-transform: uppercase;
      color: #ccc;
    }
    .progressbar li:before {
      content: counter(step);
      counter-increment: step;
      width: 30px;
      height: 30px;
      line-height: 30px;
      border: 2px solid #ccc;
      display: block;
      text-align: center;
      margin: 0 auto 10px auto;
      border-radius: 50%;
      background-color: #fff;
    }
    .progressbar li.active {
      color: #69b6b1;
    }
    .progressbar li.active:before {
      border-color: #69b6b1;
    }
    /* ESTILOS PARA LOS FORMULARIOS WIZARD */
    .wizard-step {
      display: none;
    }
    .wizard-step.active {
      display: block;
    }
    .button-group {
      text-align: center;
      margin-top: 20px;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      background: #69b6b1;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:hover {
      background: #89c5c0;
    }
    /* ESTILOS PARA INPUTS Y SECCIONES */
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    input[readonly] {
      background-color: #eee;
    }
    .small-btn {
      padding: 5px 10px;
      margin-top: 10px;
      background: #ccc;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .small-btn:hover {
      background: #bbb;
    }
    .dynamic-container {
      border: 1px dashed #ccc;
      padding: 10px;
      margin-top: 10px;
    }
    /* Alinear Checkboxes */
    .checkbox-group-col {
      display: block;
      flex-direction: column;
      gap: 5px;
      margin-top: 10px;
    }
    .checkbox-group-col .checkbox-item {
      display: block;
      align-items: center;
    }
    .checkbox-group-col .checkbox-item input[type="checkbox"] {
      margin-right: 5px;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 10px;
    }
    .extra-space {
      margin-top: 20px;
    }
    input.calc {
      background-color: #eee;
      font-weight: bold;
    }
    /* ESTILOS PARA EL FORMULARIO SECTOR */
    .sector-container {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 15px;
      border-radius: 4px;
      background: #fafafa;
    }
    table.measure-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table.measure-table th,
    table.measure-table td {
      border: 1px solid #ccc;
      padding: 5px;
      text-align: center;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      margin-top: 5px;
    }
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      vertical-align: middle;
    }
    .checkbox-item label {
      margin: 0;
      line-height: 18px;
    }
    .suggestions {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      margin-top: 5px;
      padding: 5px;
    }
    .suggestions button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 5px;
      background: #69b6b1;
      border: none;
      cursor: pointer;
    }
    .suggestions button:hover {
      background: #c4e1de;
    }
    /* ESTILOS PARA LA EXPORTACIÓN (PASO 5) */
    .report-container {
      max-width: 800px;
      margin: 20px auto;
      background-color: #fff;
      padding: 20px;
      border: 1px solid #ccc;
    }
    .header, .footer {
      text-align: center;
      margin-bottom: 20px;
    }
    .header img {
      max-width: 150px;
    }
    .header h1, .header h2 {
      margin: 10px 0;
    }
    .info-section {
      margin-bottom: 20px;
    }
    .info-section p {
      margin: 5px 0;
    }
    /* El LOV de Moneda se muestra en bloque para evitar solapamiento */
    .currency-select {
      display: block;
      margin-top: 10px;
    }
    .table-responsive {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      min-width: 600px;
    }
    table th, table td {
      border: 1px solid #333;
      padding: 8px;
      text-align: center;
    }
    .btn-export {
      display: inline-block;
      padding: 10px 20px;
      background-color: #69b6b1;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
    }
    @media print {
      /* Imprime solo el reporte centrado */
      body * {
        visibility: hidden;
      }
      .report-container, .report-container * {
        visibility: visible;
      }
      .report-container {
        position: absolute;
        left: 50%;
        top: 0;
        transform: translateX(-50%);
        width: 100%;
        max-width: 800px;
        margin: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Modal para seleccionar/crear prospecto -->
  <div class="modal" id="prospectoModal">
    <div class="modal-content">
      <h2>Seleccionar o Crear Prospecto</h2>
      <input type="text" id="prospectoSearch" placeholder="Buscar prospecto...">
      <div id="prospectoList" class="suggestions"></div>
      <p>¿No encontraste el prospecto? <button id="btnMostrarCrear">Crear Prospecto</button></p>
      <div id="crearProspectoForm" class="hidden">
        <label>Nombre y Apellido / Razón Social:</label>
        <input type="text" id="nuevoProspectoNombre" placeholder="Nombre del prospecto">
        <label>Nombre de Fantasía:</label>
        <input type="text" id="nuevoNombreFantasia" placeholder="Nombre de Fantasía del prospecto">
        <label>Teléfono:</label>
        <input type="text" id="nuevoProspectoTelefono" placeholder="Teléfono">
        <label>Dirección:</label>
        <input type="text" id="nuevoProspectoDireccion" placeholder="Dirección del prospecto">
        <label>Correo Electrónico:</label>
        <input type="email" id="nuevoProspectoCorreoElectronico" placeholder="Correo electrónico del prospecto">
        <label>Teléfono Móvil:</label>
        <input type="text" id="nuevoProspectoTelefonoMovil" placeholder="Teléfono Móvil">
        <label>Localidad :</label>
        <input type="text" id="nuevoProspectoLocalidad" placeholder="Localidad">
        <button id="btnGuardarProspecto">Guardar Prospecto</button>
      </div>
    </div>
  </div>
  
  <!-- Contenedor principal (tras seleccionar prospecto) -->
  <div id="mainContent" class="hidden">
    <div class="container">
      <h1>Sistema de Presupuestos</h1>
      
      <!-- Pantalla de selección de presupuesto -->
      <div id="landingPage" class="select-type">
        <h2>Seleccione el tipo de presupuesto</h2>
        <button id="btnPresupuestoGeneral">Presupuesto General</button>
        <button id="btnPresupuestoSector">Presupuesto por Sector</button>
      </div>
      
      <!-- FORMULARIO PRESUPUESTO GENERAL -->
      <div id="formGeneral" class="hidden">
        <h2>Presupuesto General</h2>
        <ul class="progressbar" id="progressGeneral">
          <li class="active">Datos Generales</li>
          <li>Parámetros Generales</li>
          <li>Parámetros Adicionales</li>
          <li>Resumen y Totales</li>
          <li>Reporte y Envío</li>
        </ul>
        <form id="wizardGeneral">
          <!-- Paso 1: Datos Generales y del Prospecto -->
          <div class="wizard-step active" id="genStep1">
            <h3>Datos Generales y del Prospecto</h3>
            <p class="explicacion">Presupuesto para proyectos generales.</p>
            <label for="genNumeroPresupuesto">Número de Presupuesto:</label>
            <input type="text" id="genNumeroPresupuesto" name="numero_presupuesto" value="PR-2025-001" readonly>
            <label for="genFechaPresupuesto">Fecha de Presupuesto:</label>
            <input type="date" id="genFechaPresupuesto" name="fecha_presupuesto" value="2025-04-07" readonly>
            <label for="genVendedor">Vendedor:</label>
            <input type="text" id="genVendedor" name="vendedor" value="Juan Pérez" readonly>
            <label for="genEmpresa">Empresa:</label>
            <input type="text" id="genEmpresa" name="empresa" value="Empresa XYZ" readonly>
            <label for="genProspecto">Prospecto:</label>
            <input type="text" id="genProspecto" name="prospecto" readonly>
            <label for="genFechaEnvio">Fecha de Envío:</label>
            <input type="date" id="genFechaEnvio" name="fecha_envio">
            <label for="genEstado">Estado:</label>
            <select id="genEstado" name="estado">
              <option value="">Seleccione un estado</option>
              <option value="en curso" selected>En curso</option>
              <option value="pendiente">Pendiente</option>
              <option value="enviado">Enviado</option>
              <option value="aprobado">Aprobado</option>
            </select>
          </div>
          
          <!-- Paso 2: Parámetros Generales -->
          <div class="wizard-step" id="genStep2">
            <h3>Parámetros Generales del Presupuesto</h3>
            <label for="genTipoVidrio">Tipo de Vidrio:</label>
            <select id="genTipoVidrio" name="tipo_vidrio">
              <option value="">Seleccione</option>
              <option value="DVH">DVH</option>
              <option value="Crudo">Crudo</option>
              <option value="Laminado">Laminado</option>
            </select>
            <label for="genTipoInstalacion">Tipo de Instalación:</label>
            <select id="genTipoInstalacion" name="tipo_instalacion">
              <option value="">Seleccione</option>
              <option value="Interior">Interior</option>
              <option value="Exterior">Exterior</option>
            </select>
            <label for="genTipoProducto">Tipo de Producto:</label>
            <select id="genTipoProducto" name="tipo_producto">
              <option value="">Seleccione</option>
              <option value="Seguridad">Seguridad</option>
              <option value="Privacidad">Privacidad</option>
            </select>
            <button type="button" class="small-btn" onclick="addLaminaGeneral()">Agregar lámina</button>
            <div id="laminasContainerGeneral"></div>
            <h4>Medidas</h4>
            <button type="button" class="small-btn" onclick="addMedidaGeneral()">Agregar Medida</button>
            <div id="medidasContainerGeneral"></div>
          </div>
          
          <!-- Paso 3: Parámetros Adicionales -->
          <div class="wizard-step" id="genStep3">
            <h3>Parámetros Adicionales de Instalación</h3>
            <label for="genAyudante">Ayudante:</label>
            <input type="number" id="genAyudante" name="ayudante" placeholder="Ingrese cantidad">
            <div class="checkbox-group-col">
              <div class="checkbox-item">
                <label for="instTechos">Instalación en techos</label>
                <input type="checkbox" id="instTechos" name="inst_techos">
              </div>
              <div class="checkbox-item">
                <label for="instAltura">Instalación en altura</label>
                <input type="checkbox" id="instAltura" name="inst_altura">
              </div>
              <div class="checkbox-item">
                <label for="usoPergolas">Instalación en pérgolas o claraboya</label>
                <input type="checkbox" id="usoPergolas" name="uso_pergolas">
              </div>
              <div class="checkbox-item">
                <label for="usoSilletas">Uso de silletas</label>
                <input type="checkbox" id="usoSilletas" name="uso_silletas">
              </div>
              <div class="checkbox-item">
                <label for="vidrioRepartido">Instalación en vidrio repartido</label>
                <input type="checkbox" id="vidrioRepartido" name="vidrio_repartido">
              </div>
            </div>
            <div class="extra-space"></div>
            <label for="genEscaleras">Escaleras (cantidad):</label>
            <input type="number" id="genEscaleras" name="escaleras" placeholder="Cantidad">
            <label for="genAndamios">Andamios (cuerpos):</label>
            <input type="number" id="genAndamios" name="andamios" placeholder="Cantidad">
            <h4>Ubicación de la obra</h4>
            <div class="checkbox-group">
              <div>
                <input type="checkbox" id="genCABA" name="caba_gba">
                <label for="genCABA">CABA/GBA</label>
              </div>
              <div>
                <input type="checkbox" id="genInterior" name="obra_interior">
                <label for="genInterior">Interior del país</label>
              </div>
            </div>
            <div id="costoInterior" style="display: none;">
              <label for="genDias200km">Días a más de 200km:</label>
              <input type="number" id="genDias200km" name="dias200km" placeholder="Ingrese días">
            </div>
          </div>
          
          <!-- Paso 4: Resumen y Totales (Presupuesto General con Información Completa) -->
          <div class="wizard-step" id="genStep4">
            <h3>Resumen y Totales</h3>
            <button type="button" class="small-btn" onclick="calcularTotalesGeneral()">Calcular</button>
            <div id="totales">
              <label for="areaTotal">Área Total (m²):</label>
              <input type="text" id="areaTotal" class="calc" readonly>
              <label for="metrosLineales">Metros Lineales:</label>
              <input type="text" id="metrosLineales" class="calc" readonly>
            </div>
            <!-- Se muestra el resumen completo con la información de pasos 1, 2 y 3 -->
            <div id="resumenGeneral"></div>
          </div>
          
          <!-- Paso 5: Reporte y Envío (Presupuesto General) -->
          <div class="wizard-step" id="genStep5">
            <h3>Reporte y Envío</h3>
            <div class="report-container" id="reportGeneral">
              <!-- Encabezado del Reporte -->
              <div class="header">
                <img src="./QOR.png" alt="Logo de la Empresa">
                <h1>Reporte de Presupuesto</h1>
                <p><strong>Empresa XYZ</strong> - Calle Falsa 123, Ciudad, País</p>
                <p>Tel: (123) 456-7890 | Email: info@empresa.xyz</p>
              </div>
              <!-- Información del Presupuesto -->
              <div class="info-section">
                <h2>Información del Presupuesto</h2>
                <p><strong>Número:</strong> <span id="genNumeroPresupuestoReporte"></span></p>
                <p><strong>Fecha de Emisión:</strong> <span id="genFechaEmision"></span></p>
                <p><strong>Estado:</strong> <span id="genEstadoReporte"></span></p>
                <p>
                  <strong>Moneda de Cotización:</strong>
                  <select id="genMonedaSelect" class="currency-select">
                    <option value="ARS">Pesos (ARS)</option>
                    <option value="USD">Dólares (USD)</option>
                    <option value="AMBOS">Pesos y Dólares</option>
                  </select>
                </p>
              </div>
              <!-- Datos Generales -->
              <div class="info-section">
                <h2>Datos Generales</h2>
                <p><strong>Vendedor:</strong> <span id="genVendedorReporte"></span></p>
                <p><strong>Empresa:</strong> <span id="genEmpresaReporte"></span></p>
                <p><strong>Prospecto:</strong> <span id="genProspectoReporte"></span></p>
              </div>
              <!-- Tabla Resumen (sin columna Sector) -->
              <div class="info-section">
                <h2>Resumen</h2>
                <div class="table-responsive">
                  <table id="tablaResumenGeneral">
                    <thead>
                      <tr>
                        <th>Descripción</th>
                        <th>Tipo de Vidrio</th>
                        <th>Instalación</th>
                        <th>Tipo de Lámina</th>
                        <th>Importe Final</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Filas generadas dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- Pie de Página -->
              <div class="footer">
                <p>Gracias por confiar en Empresa XYZ.</p>
                <p>Para más información, contáctenos a info@empresa.xyz</p>
                <p>Página <span class="pageNumber">1 de 1</span></p>
              </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
              <button class="btn-export" onclick="exportToPDF()">Exportar a PDF</button>
            </div>
          </div>
          
          <div class="button-group">
            <a href="./inicial.html"><button type="button" class="btn">Volver al menú inicial</button></a>
            <button type="button" class="btn" onclick="prevStep('gen')">Anterior</button>
            <button type="button" class="btn" id="genNextBtn" onclick="nextStep('gen')">Siguiente</button>
            <button type="submit" class="btn" id="genSubmitBtn" style="display: none;">Guardar y Enviar Presupuesto</button>
          </div>
        </form>
      </div>
      
      <!-- FORMULARIO PRESUPUESTO POR SECTOR -->
      <div id="formSector" class="hidden">
        <h2>Presupuesto por Sector</h2>
        <ul class="progressbar" id="progressSector">
          <li class="active">Datos Generales</li>
          <li>Parámetros por Sector</li>
          <li>Parámetros Adicionales</li>
          <li>Resumen y Totales</li>
          <li>Reporte y Envío</li>
        </ul>
        <form id="wizardSector">
          <!-- Paso 1: Datos Generales y del Prospecto -->
          <div class="wizard-step active" id="secStep1">
            <h3>Datos Generales y del Prospecto</h3>
            <p class="explicacion">Presupuesto para proyectos por sector.</p>
            <label for="secNumeroPresupuesto">Número de Presupuesto:</label>
            <input type="text" id="secNumeroPresupuesto" name="numero_presupuesto" value="PR-2025-002" readonly>
            <label for="secFechaPresupuesto">Fecha de Presupuesto:</label>
            <input type="date" id="secFechaPresupuesto" name="fecha_presupuesto" value="2025-04-07" readonly>
            <label for="secVendedor">Vendedor:</label>
            <input type="text" id="secVendedor" name="vendedor" value="Juan Pérez" readonly>
            <label for="secEmpresa">Empresa:</label>
            <input type="text" id="secEmpresa" name="empresa" value="Empresa XYZ" readonly>
            <label for="secProspecto">Prospecto:</label>
            <input type="text" id="secProspecto" name="prospecto" readonly>
            <label for="secFechaEnvio">Fecha de Envío:</label>
            <input type="date" id="secFechaEnvio" name="fecha_envio">
            <label for="secEstado">Estado:</label>
            <select id="secEstado" name="estado">
              <option value="">Seleccione un estado</option>
              <option value="en curso" selected>En curso</option>
              <option value="pendiente">Pendiente</option>
              <option value="enviado">Enviado</option>
              <option value="aprobado">Aprobado</option>
            </select>
          </div>
          
          <!-- Paso 2: Parámetros por Sector -->
          <div class="wizard-step" id="secStep2">
            <h3>Parámetros por Sector</h3>
            <button type="button" class="small-btn" onclick="addSector()">Agregar Sector</button>
            <div id="sectorsContainer"></div>
          </div>
          
          <!-- Paso 3: Parámetros Adicionales -->
          <div class="wizard-step" id="secStep3">
            <h3>Parámetros Adicionales de Instalación</h3>
            <label for="secAyudante">Ayudante:</label>
            <input type="number" id="secAyudante" name="ayudante" placeholder="Ingrese cantidad">
            <div class="checkbox-group-col">
              <div class="checkbox-item">
                <input type="checkbox" id="secInstTechos" name="inst_techos">
                <label for="secInstTechos">Instalación en techos</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="secInstAltura" name="inst_altura">
                <label for="secInstAltura">Instalación en altura</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="secUsoPergolas" name="uso_pergolas">
                <label for="secUsoPergolas">Instalación en pérgola o claraboya</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="secUsoSilletas" name="uso_silletas">
                <label for="secUsoSilletas">Uso de silletas</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="secVidrioRepartido" name="vidrio_repartido">
                <label for="secVidrioRepartido">Instalación en vidrio repartido</label>
              </div>
            </div>
            <div class="extra-space"></div>
            <label for="secEscaleras">Escaleras (cantidad):</label>
            <input type="number" id="secEscaleras" name="escaleras" placeholder="Cantidad">
            <label for="secAndamios">Andamios (cantidad):</label>
            <input type="number" id="secAndamios" name="andamios" placeholder="Cantidad">
            <h4>Ubicación de la obra</h4>
            <div class="checkbox-group">
              <div>
                <input type="checkbox" id="secCABA" name="caba_gba">
                <label for="secCABA">CABA/GBA</label>
              </div>
              <div>
                <input type="checkbox" id="secInterior" name="obra_interior">
                <label for="secInterior">Interior del país</label>
              </div>
            </div>
            <div id="costoInteriorSector" style="display: none;">
              <label for="secDias200km">Días a más de 200km:</label>
              <input type="number" id="secDias200km" name="dias200km" placeholder="Ingrese días">
            </div>
          </div>
          
          <!-- Paso 4: Resumen y Totales (Presupuesto por Sector - Información Completa) -->
          <div class="wizard-step" id="secStep4">
            <h3>Resumen y Totales</h3>
            <button type="button" class="small-btn" onclick="calcularTotalesSector()">Calcular</button>
            <div id="totalesSector">
              <label for="secAreaTotal">Área Total (m²):</label>
              <input type="text" id="secAreaTotal" class="calc" readonly>
              <label for="secMetrosLineales">Metros Lineales:</label>
              <input type="text" id="secMetrosLineales" class="calc" readonly>
            </div>
            <!-- Construir un resumen completo con:
                 • Datos Generales (Paso 1)
                 • Parámetros Adicionales (Paso 3)
                 • Resumen por Sector (incluyendo medidas) -->
            <div id="resumenSector"></div>
          </div>
          
          <!-- Paso 5: Reporte y Envío (Presupuesto por Sector) -->
          <div class="wizard-step" id="secStep5">
            <h3>Reporte y Envío</h3>
            <div class="report-container" id="reportSector">
              <!-- Encabezado del Reporte -->
              <div class="header">
                <img src="./QOR.png" alt="Logo de la Empresa">
                <h1>Reporte de Presupuesto</h1>
                <p><strong>Empresa XYZ</strong> - Calle Falsa 123, Ciudad, País</p>
                <p>Tel: (123) 456-7890 | Email: info@empresa.xyz</p>
              </div>
              <!-- Información del Presupuesto -->
              <div class="info-section">
                <h2>Información del Presupuesto</h2>
                <p><strong>Número:</strong> <span id="secNumeroPresupuestoReporte"></span></p>
                <p><strong>Fecha de Emisión:</strong> <span id="secFechaEmision"></span></p>
                <p><strong>Estado:</strong> <span id="secEstadoReporte"></span></p>
                <p>
                  <strong>Moneda de Cotización:</strong>
                  <select id="secMonedaSelect" class="currency-select">
                    <option value="ARS">Pesos (ARS)</option>
                    <option value="USD">Dólares (USD)</option>
                    <option value="AMBOS">Pesos y Dólares</option>
                  </select>
                </p>
              </div>
              <!-- Datos Generales -->
              <div class="info-section">
                <h2>Datos Generales</h2>
                <p><strong>Vendedor:</strong> <span id="secVendedorReporte"></span></p>
                <p><strong>Empresa:</strong> <span id="secEmpresaReporte"></span></p>
                <p><strong>Prospecto:</strong> <span id="secProspectoReporte"></span></p>
              </div>
              <!-- Tabla Resumen (Incluye la columna "Sector") -->
              <div class="info-section">
                <h2>Resumen</h2>
                <div class="table-responsive">
                  <table id="tablaResumenSector">
                    <thead>
                      <tr>
                        <th>Sector</th>
                        <th>Descripción</th>
                        <th>Tipo de Vidrio</th>
                        <th>Instalación</th>
                        <th>Tipo de Lámina</th>
                        <th>Importe Final</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Filas generadas dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- Pie de Página -->
              <div class="footer">
                <p>Gracias por confiar en Empresa XYZ.</p>
                <p>Para más información, contáctenos a info@empresa.xyz</p>
                <p>Página <span class="pageNumber">1 de 1</span></p>
              </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
              <button class="btn-export" onclick="exportToPDF()">Exportar a PDF</button>
            </div>
          </div>
          
          <div class="button-group">
            <a href="./inicial.html"><button type="button" class="btn">Volver al menú inicial</button></a>
            <button type="button" class="btn" onclick="prevStep('sec')">Anterior</button>
            <button type="button" class="btn" id="secNextBtn" onclick="nextStep('sec')">Siguiente</button>
            <button type="submit" class="btn" id="secSubmitBtn" style="display: none;">Guardar y Enviar Presupuesto</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      /********* PROSPECTO: Modal y Lógica de Selección/Creación *********/
      const prospectoModal = document.getElementById("prospectoModal");
      const mainContent = document.getElementById("mainContent");
      const prospectoSearch = document.getElementById("prospectoSearch");
      const prospectoList = document.getElementById("prospectoList");
      const btnMostrarCrear = document.getElementById("btnMostrarCrear");
      const crearProspectoForm = document.getElementById("crearProspectoForm");
      const btnGuardarProspecto = document.getElementById("btnGuardarProspecto");

      // Lista simulada de prospectos
      const prospectos = [
        { id: 1, nombre: "Prospecto A" },
        { id: 2, nombre: "Prospecto B" },
        { id: 3, nombre: "Prospecto C" }
      ];
      
      prospectoSearch.addEventListener("input", function() {
        const termino = prospectoSearch.value.toLowerCase();
        prospectoList.innerHTML = "";
        const resultados = prospectos.filter(p => p.nombre.toLowerCase().includes(termino));
        if(resultados.length > 0){
          resultados.forEach(p => {
            const btn = document.createElement("button");
            btn.textContent = p.nombre;
            btn.addEventListener("click", function() {
              seleccionarProspecto(p);
            });
            prospectoList.appendChild(btn);
          });
        } else {
          prospectoList.innerHTML = "<p>No se encontraron prospectos. Puedes crearlo.</p>";
        }
      });
      
      btnMostrarCrear.addEventListener("click", function() {
        crearProspectoForm.style.display = "block";
      });
      
      btnGuardarProspecto.addEventListener("click", function() {
        const nombre = document.getElementById("nuevoProspectoNombre").value;
        if(nombre.trim() !== ""){
          const nuevo = { id: Date.now(), nombre };
          prospectos.push(nuevo);
          seleccionarProspecto(nuevo);
        }
      });
      
      function seleccionarProspecto(p) {
        document.getElementById("genProspecto").value = p.nombre;
        document.getElementById("secProspecto").value = p.nombre;
        prospectoModal.remove();
        mainContent.classList.remove("hidden");
      }
      
      /********* VARIABLES GLOBALES *********/
      const conversionRate = 100;
      const laminaPrices = {
        "Lámina A": 50,
        "Lámina B": 75,
        "Lámina C": 100
      };
      
      // Arreglos para almacenar datos de cada formulario
      let lineItemsGeneral = [];
      let lineItemsSector = [];
      
      let genCurrentStep = 1;
      const totalGenSteps = 5;
      let secCurrentStep = 1;
      const totalSecSteps = 5;
      
      /********* Funciones para actualizar los steps *********/
      function showStep(prefix, step) {
        const totalSteps = prefix === 'gen' ? totalGenSteps : totalSecSteps;
        for (let i = 1; i <= totalSteps; i++) {
          const elem = document.getElementById(prefix + "Step" + i);
          if(elem){
            elem.classList.toggle("active", i === step);
          }
        }
        const progressBar = document.getElementById(prefix === 'gen' ? "progressGeneral" : "progressSector");
        const items = progressBar.getElementsByTagName("li");
        for (let i = 0; i < items.length; i++) {
          items[i].classList.toggle("active", i < step);
        }
        if(prefix === 'gen') {
          if(genCurrentStep === totalGenSteps){
            document.getElementById("genNextBtn").disabled = true;
            document.getElementById("genNextBtn").style.backgroundColor = "#ccc";
            document.getElementById("genSubmitBtn").style.display = "inline-block";
          } else {
            document.getElementById("genNextBtn").disabled = false;
            document.getElementById("genNextBtn").style.backgroundColor = "#69b6b1";
            document.getElementById("genSubmitBtn").style.display = "none";
          }
        } else if(prefix === 'sec') {
          if(secCurrentStep === totalSecSteps){
            document.getElementById("secNextBtn").disabled = true;
            document.getElementById("secNextBtn").style.backgroundColor = "#ccc";
            document.getElementById("secSubmitBtn").style.display = "inline-block";
          } else {
            document.getElementById("secNextBtn").disabled = false;
            document.getElementById("secNextBtn").style.backgroundColor = "#69b6b1";
            document.getElementById("secSubmitBtn").style.display = "none";
          }
        }
      }
      
      function nextStep(prefix) {
        if(prefix === 'gen' && genCurrentStep < totalGenSteps) {
          genCurrentStep++;
          showStep('gen', genCurrentStep);
        } else if(prefix === 'sec' && secCurrentStep < totalSecSteps) {
          secCurrentStep++;
          showStep('sec', secCurrentStep);
        }
      }
      function prevStep(prefix) {
        if(prefix === 'gen' && genCurrentStep > 1) {
          genCurrentStep--;
          showStep('gen', genCurrentStep);
        } else if(prefix === 'sec' && secCurrentStep > 1) {
          secCurrentStep--;
          showStep('sec', secCurrentStep);
        }
      }
      
      /********* Funciones para el Formulario General *********/
      function addLaminaGeneral() {
        const container = document.getElementById("laminasContainerGeneral");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Lámina:</label>
          <select name="laminas[]">
            <option value="Lámina A">Lámina A</option>
            <option value="Lámina B">Lámina B</option>
            <option value="Lámina C">Lámina C</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar lámina</button>
        `;
        container.appendChild(div);
      }
      
      function addMedidaGeneral() {
        const container = document.getElementById("medidasContainerGeneral");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Ancho (m):</label>
          <input type="number" step="0.01" name="medida_ancho[]" placeholder="Ancho">
          <label>Alto (m):</label>
          <input type="number" step="0.01" name="medida_alto[]" placeholder="Alto">
          <label>Cantidad:</label>
          <input type="number" name="medida_cantidad[]" placeholder="Cantidad">
          <label>Despolarizado:</label>
          <select name="medida_despolarizado[]">
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar Medida</button>
        `;
        container.appendChild(div);
      }
      
      function buildMeasureTable(measures) {
        let tableHtml = `<table class="measure-table">
          <thead>
            <tr>
              <th>Ancho (m)</th>
              <th>Alto (m)</th>
              <th>Cantidad</th>
              <th>Despolarizado</th>
            </tr>
          </thead>
          <tbody>`;
        measures.forEach(m => {
          tableHtml += `
            <tr>
              <td>${m.ancho}</td>
              <td>${m.alto}</td>
              <td>${m.cantidad}</td>
              <td>${m.despolarizado ? 'Sí' : 'No'}</td>
            </tr>`;
        });
        tableHtml += `</tbody></table>`;
        return tableHtml;
      }
      
      function calcularTotalesGeneral() {
        let areaTotal = 0;
        let metrosLineales = 0;
        let measureData = [];
        const medidas = document.querySelectorAll("#medidasContainerGeneral .dynamic-container");
        medidas.forEach(div => {
          const ancho = parseFloat(div.querySelector('input[name="medida_ancho[]"]').value) || 0;
          const alto = parseFloat(div.querySelector('input[name="medida_alto[]"]').value) || 0;
          const cantidad = parseInt(div.querySelector('input[name="medida_cantidad[]"]').value) || 0;
          areaTotal += ancho * alto * cantidad;
          metrosLineales += ancho * cantidad;
          measureData.push({
            ancho: ancho.toFixed(2),
            alto: alto.toFixed(2),
            cantidad: cantidad,
            despolarizado: (div.querySelector('select[name="medida_despolarizado[]"]').value === "true")
          });
        });
        document.getElementById("areaTotal").value = areaTotal.toFixed(2);
        document.getElementById("metrosLineales").value = metrosLineales.toFixed(2);
        
        // Acumular datos por cada lámina
        lineItemsGeneral = [];
        const laminaContainers = document.querySelectorAll("#laminasContainerGeneral .dynamic-container");
        laminaContainers.forEach(div => {
          const selectElem = div.querySelector('select[name="laminas[]"]');
          if(selectElem) {
            const laminaType = selectElem.value;
            if(laminaType) {
              let price = laminaPrices[laminaType] || 0;
              let importeARS = areaTotal * price;
              let importeUSD = importeARS / conversionRate;
              lineItemsGeneral.push({
                descripcion: document.getElementById("genTipoProducto").value || "-",
                tipoVidrio: document.getElementById("genTipoVidrio").value || "-",
                instalacion: document.getElementById("genTipoInstalacion").value || "-",
                lamina: laminaType,
                finalArs: importeARS,
                finalUsd: importeUSD
              });
            }
          }
        });
        
        // Construir el resumen completo con datos de los pasos 1, 2 y 3
        let resumenHtml = `
          <h4>Resumen Presupuesto General</h4>
          <p><strong>Número:</strong> ${document.getElementById("genNumeroPresupuesto").value}</p>
          <p><strong>Fecha Presupuesto:</strong> ${document.getElementById("genFechaPresupuesto").value}</p>
          <p><strong>Fecha Envío:</strong> ${document.getElementById("genFechaEnvio").value}</p>
          <p><strong>Estado:</strong> ${document.getElementById("genEstado").value}</p>
          <p><strong>Prospecto:</strong> ${document.getElementById("genProspecto").value}</p>
          <hr>
          <h4>Parámetros Generales</h4>
          <p><strong>Tipo de Vidrio:</strong> ${document.getElementById("genTipoVidrio").value}</p>
          <p><strong>Tipo de Instalación:</strong> ${document.getElementById("genTipoInstalacion").value}</p>
          <p><strong>Tipo de Producto:</strong> ${document.getElementById("genTipoProducto").value}</p>
          <hr>
          <h4>Parámetros Adicionales</h4>
          <p><strong>Ayudante:</strong> ${document.getElementById("genAyudante").value}</p>
          <p><strong>Instalación en techos:</strong> ${document.getElementById("instTechos").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en altura:</strong> ${document.getElementById("instAltura").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en pérgola o claraboya:</strong> ${document.getElementById("usoPergolas").checked ? "Sí" : "No"}</p>
          <p><strong>Uso de silletas:</strong> ${document.getElementById("usoSilletas").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en vidrio repartido:</strong> ${document.getElementById("vidrioRepartido").checked ? "Sí" : "No"}</p>
          <p><strong>Escaleras:</strong> ${document.getElementById("genEscaleras").value}</p>
          <p><strong>Andamios:</strong> ${document.getElementById("genAndamios").value}</p>
          <hr>
          <h4>Ubicación</h4>
          <p><strong>CABA/GBA:</strong> ${document.getElementById("genCABA").checked ? "Sí" : "No"}</p>
          <p><strong>Interior del país:</strong> ${document.getElementById("genInterior").checked ? "Sí" : "No"}</p>
          ${document.getElementById("genInterior").checked ? `<p><strong>Días a más de 200km:</strong> ${document.getElementById("genDias200km").value}</p>` : ""}
          <hr>
          <h4>Totales</h4>
          <p><strong>Área Total (m²):</strong> ${areaTotal.toFixed(2)}</p>
          <p><strong>Metros Lineales:</strong> ${metrosLineales.toFixed(2)}</p>
          <hr>
          <h4>Importe por Lámina</h4>
        `;
        lineItemsGeneral.forEach(item => {
          let moneda = document.getElementById("genMonedaSelect").value;
          let importeFinal = "";
          if(moneda === "ARS") {
            importeFinal = `$ ${item.finalArs.toFixed(2)}`;
          } else if(moneda === "USD") {
            importeFinal = `U$D ${item.finalUsd.toFixed(2)}`;
          } else {
            importeFinal = `$ ${item.finalArs.toFixed(2)} / U$D ${item.finalUsd.toFixed(2)}`;
          }
          resumenHtml += `<p><strong>${item.lamina}</strong> - ${item.descripcion} | ${item.tipoVidrio} | ${item.instalacion} | Importe: ${importeFinal}</p>`;
        });
        resumenHtml += `<hr><h4>Medidas Ingresadas</h4>${buildMeasureTable(measureData)}`;
        document.getElementById("resumenGeneral").innerHTML = resumenHtml;
        
        // Actualiza los datos del reporte (Paso 5) para el formulario General
        document.getElementById("genNumeroPresupuestoReporte").textContent = document.getElementById("genNumeroPresupuesto").value;
        document.getElementById("genFechaEmision").textContent = new Date().toLocaleDateString();
        document.getElementById("genEstadoReporte").textContent = document.getElementById("genEstado").value;
        document.getElementById("genVendedorReporte").textContent = document.getElementById("genVendedor").value;
        document.getElementById("genEmpresaReporte").textContent = document.getElementById("genEmpresa").value;
        document.getElementById("genProspectoReporte").textContent = document.getElementById("genProspecto").value;
        updateTablaResumenGeneral();
      }
      
      function updateTablaResumenGeneral() {
        const moneda = document.getElementById("genMonedaSelect").value;
        const tbody = document.querySelector("#tablaResumenGeneral tbody");
        tbody.innerHTML = "";
        lineItemsGeneral.forEach(item => {
          let importeFinal = "";
          if(moneda === "ARS") {
            importeFinal = `$ ${item.finalArs.toFixed(2)}`;
          } else if(moneda === "USD") {
            importeFinal = `U$D ${item.finalUsd.toFixed(2)}`;
          } else {
            importeFinal = `$ ${item.finalArs.toFixed(2)} / U$D ${item.finalUsd.toFixed(2)}`;
          }
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.descripcion}</td>
            <td>${item.tipoVidrio}</td>
            <td>${item.instalacion}</td>
            <td>${item.lamina}</td>
            <td>${importeFinal}</td>
          `;
          tbody.appendChild(row);
        });
      }
      
      document.getElementById("genMonedaSelect").addEventListener("change", updateTablaResumenGeneral);
      
      /********* Funciones para el Formulario Sector *********/
      let sectorCount = 0;
      function addSector() {
        const container = document.getElementById("sectorsContainer");
        const div = document.createElement("div");
        div.classList.add("sector-container");
        div.dataset.sectorIndex = sectorCount;
        div.innerHTML = `
          <h4>Sector ${sectorCount + 1}</h4>
          <label>Nombre del Sector:</label>
          <input type="text" name="sector_nombre[]" placeholder="Ingrese nombre del sector" required>
          <label>Tipo de Vidrio:</label>
          <select name="sector_tipo_vidrio[]" required>
            <option value="">Seleccione</option>
            <option value="DVH">DVH</option>
            <option value="Crudo">Crudo</option>
            <option value="Laminado">Laminado</option>
          </select>
          <label>Tipo de Instalación:</label>
          <select name="sector_tipo_instalacion[]" required>
            <option value="">Seleccione</option>
            <option value="Interior">Interior</option>
            <option value="Exterior">Exterior</option>
          </select>
          <label>Tipo de Producto:</label>
          <select name="sector_tipo_producto[]" required>
            <option value="">Seleccione</option>
            <option value="Seguridad">Seguridad</option>
            <option value="Privacidad">Privacidad</option>
          </select>
          <button type="button" class="small-btn" onclick="addLaminaInSector(this)">Agregar lámina</button>
          <div class="laminasContainerSector"></div>
          <h5>Medidas del Sector</h5>
          <button type="button" class="small-btn" onclick="addMedidaInSector(this)">Agregar Medida</button>
          <div class="medidasContainerSector"></div>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar Sector</button>
        `;
        container.appendChild(div);
        sectorCount++;
      }
      
      function addLaminaInSector(btn) {
        const container = btn.parentElement.querySelector(".laminasContainerSector");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Lámina:</label>
          <select name="sector_laminas[]">
            <option value="Lámina A">Lámina A</option>
            <option value="Lámina B">Lámina B</option>
            <option value="Lámina C">Lámina C</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar lámina</button>
        `;
        container.appendChild(div);
      }
      
      function addMedidaInSector(btn) {
        const container = btn.parentElement.querySelector(".medidasContainerSector");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Ancho (m):</label>
          <input type="number" step="0.01" name="sector_medida_ancho[]" placeholder="Ancho">
          <label>Alto (m):</label>
          <input type="number" step="0.01" name="sector_medida_alto[]" placeholder="Alto">
          <label>Cantidad:</label>
          <input type="number" name="sector_medida_cantidad[]" placeholder="Cantidad">
          <label>Despolarizado:</label>
          <select name="sector_medida_despolarizado[]">
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar Medida</button>
        `;
        container.appendChild(div);
      }
      
      function buildSectorMeasureTable(measures) {
        let tableHtml = `<table class="measure-table">
          <thead>
            <tr>
              <th>Ancho (m)</th>
              <th>Alto (m)</th>
              <th>Cantidad</th>
              <th>Despolarizado</th>
            </tr>
          </thead>
          <tbody>`;
        measures.forEach(m => {
          tableHtml += `
            <tr>
              <td>${m.ancho}</td>
              <td>${m.alto}</td>
              <td>${m.cantidad}</td>
              <td>${m.despolarizado ? 'Sí' : 'No'}</td>
            </tr>`;
        });
        tableHtml += `</tbody></table>`;
        return tableHtml;
      }
      
      function calcularTotalesSector() {
        let globalAreaTotal = 0;
        let globalMetrosLineales = 0;
        lineItemsSector = [];
        let sectorsSummary = "";
        const sectors = document.querySelectorAll("#sectorsContainer .sector-container");
        sectors.forEach((sectorDiv, idx) => {
          const sectorName = sectorDiv.querySelector('input[name="sector_nombre[]"]').value || ("Sector " + (idx + 1));
          const tipoVidrio = sectorDiv.querySelector('select[name="sector_tipo_vidrio[]"]').value || "-";
          const tipoInstalacion = sectorDiv.querySelector('select[name="sector_tipo_instalacion[]"]').value || "-";
          const tipoProducto = sectorDiv.querySelector('select[name="sector_tipo_producto[]"]').value || "-";
          let sectorArea = 0;
          let sectorMetros = 0;
          let measureData = [];
          const medidas = sectorDiv.querySelectorAll(".medidasContainerSector .dynamic-container");
          medidas.forEach(div => {
            const ancho = parseFloat(div.querySelector('input[name="sector_medida_ancho[]"]').value) || 0;
            const alto = parseFloat(div.querySelector('input[name="sector_medida_alto[]"]').value) || 0;
            const cantidad = parseInt(div.querySelector('input[name="sector_medida_cantidad[]"]').value) || 0;
            sectorArea += ancho * alto * cantidad;
            sectorMetros += ancho * cantidad;
            measureData.push({
              ancho: ancho.toFixed(2),
              alto: alto.toFixed(2),
              cantidad: cantidad,
              despolarizado: (div.querySelector('select[name="sector_medida_despolarizado[]"]').value === "true")
            });
          });
          globalAreaTotal += sectorArea;
          globalMetrosLineales += sectorMetros;
          
          // Acumular datos por lámina de este sector
          const laminaContainers = sectorDiv.querySelectorAll(".laminasContainerSector .dynamic-container");
          laminaContainers.forEach(div => {
            const selectElem = div.querySelector('select[name="sector_laminas[]"]');
            if(selectElem) {
              const laminaType = selectElem.value;
              if(laminaType) {
                let price = laminaPrices[laminaType] || 0;
                let finalArs = sectorArea * price;
                let finalUsd = finalArs / conversionRate;
                lineItemsSector.push({
                  sector: sectorName,
                  descripcion: tipoProducto,
                  tipoVidrio: tipoVidrio,
                  instalacion: tipoInstalacion,
                  lamina: laminaType,
                  finalArs: finalArs,
                  finalUsd: finalUsd
                });
              }
            }
          });
          // Construir el bloque resumen para cada sector, incluyendo la tabla de medidas
          let sectorHtml = `
            <div style="border: 1px solid #aaa; margin-top: 10px; padding: 5px;">
              <h5>${sectorName}</h5>
              <p><strong>Tipo de Vidrio:</strong> ${tipoVidrio}</p>
              <p><strong>Tipo de Instalación:</strong> ${tipoInstalacion}</p>
              <p><strong>Tipo de Producto:</strong> ${tipoProducto}</p>
              <p><strong>Área del Sector (m²):</strong> ${sectorArea.toFixed(2)}</p>
              <p><strong>Metros Lineales:</strong> ${sectorMetros.toFixed(2)}</p>
              <h5>Medidas del Sector</h5>
              ${buildSectorMeasureTable(measureData)}
            </div>
          `;
          sectorsSummary += sectorHtml;
        });
        document.getElementById("secAreaTotal").value = globalAreaTotal.toFixed(2);
        document.getElementById("secMetrosLineales").value = globalMetrosLineales.toFixed(2);
        
        // Construir el resumen completo del Presupuesto por Sector con los datos de los pasos 1, 3 y el resumen de sectores
        let resumenHtmlSector = `
          <h4>Resumen Presupuesto por Sector</h4>
          <p><strong>Número:</strong> ${document.getElementById("secNumeroPresupuesto").value}</p>
          <p><strong>Fecha Presupuesto:</strong> ${document.getElementById("secFechaPresupuesto").value}</p>
          <p><strong>Fecha Envío:</strong> ${document.getElementById("secFechaEnvio").value}</p>
          <p><strong>Estado:</strong> ${document.getElementById("secEstado").value}</p>
          <p><strong>Prospecto:</strong> ${document.getElementById("secProspecto").value}</p>
          <hr>
          <h4>Parámetros Adicionales</h4>
          <p><strong>Ayudante:</strong> ${document.getElementById("secAyudante").value}</p>
          <p><strong>Instalación en techos:</strong> ${document.getElementById("secInstTechos").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en altura:</strong> ${document.getElementById("secInstAltura").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en pérgola o claraboya:</strong> ${document.getElementById("secUsoPergolas").checked ? "Sí" : "No"}</p>
          <p><strong>Uso de silletas:</strong> ${document.getElementById("secUsoSilletas").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en vidrio repartido:</strong> ${document.getElementById("secVidrioRepartido").checked ? "Sí" : "No"}</p>
          <p><strong>Escaleras:</strong> ${document.getElementById("secEscaleras").value}</p>
          <p><strong>Andamios:</strong> ${document.getElementById("secAndamios").value}</p>
          <hr>
          <h4>Ubicación</h4>
          <p><strong>CABA/GBA:</strong> ${document.getElementById("secCABA").checked ? "Sí" : "No"}</p>
          <p><strong>Interior del país:</strong> ${document.getElementById("secInterior").checked ? "Sí" : "No"}</p>
          ${document.getElementById("secInterior").checked ? `<p><strong>Días a más de 200km:</strong> ${document.getElementById("secDias200km").value}</p>` : ""}
          <hr>
          <h4>Totales Globales</h4>
          <p><strong>Área Total Global (m²):</strong> ${globalAreaTotal.toFixed(2)}</p>
          <p><strong>Metros Lineales Global:</strong> ${globalMetrosLineales.toFixed(2)}</p>
          <hr>
          <h4>Resumen por Sectores</h4>
          ${sectorsSummary}
          <hr>
          <h4>Importe por Lámina (por Sector)</h4>
        `;
        lineItemsSector.forEach(item => {
          let moneda = document.getElementById("secMonedaSelect").value;
          let importeFinal = "";
          if(moneda === "ARS") {
            importeFinal = `$ ${item.finalArs.toFixed(2)}`;
          } else if(moneda === "USD") {
            importeFinal = `U$D ${item.finalUsd.toFixed(2)}`;
          } else {
            importeFinal = `$ ${item.finalArs.toFixed(2)} / U$D ${item.finalUsd.toFixed(2)}`;
          }
          resumenHtmlSector += `<p><strong>${item.lamina}</strong> - ${item.descripcion} | ${item.tipoVidrio} | ${item.instalacion} | <strong>Sector:</strong> ${item.sector} | Importe: ${importeFinal}</p>`;
        });
        resumenHtmlSector += `<hr><h4>Medidas Ingresadas</h4>`;
        // (Opcionalmente, se puede agregar una tabla con medidas acumuladas globales de sectores)
        
        document.getElementById("resumenSector").innerHTML = resumenHtmlSector;
        
        // Actualiza los datos del reporte (Paso 5) para el formulario Sector
        document.getElementById("secNumeroPresupuestoReporte").textContent = document.getElementById("secNumeroPresupuesto").value;
        document.getElementById("secFechaEmision").textContent = new Date().toLocaleDateString();
        document.getElementById("secEstadoReporte").textContent = document.getElementById("secEstado").value;
        document.getElementById("secVendedorReporte").textContent = document.getElementById("secVendedor").value;
        document.getElementById("secEmpresaReporte").textContent = document.getElementById("secEmpresa").value;
        document.getElementById("secProspectoReporte").textContent = document.getElementById("secProspecto").value;
        updateTablaResumenSector();
      }
      
      function updateTablaResumenSector() {
        const moneda = document.getElementById("secMonedaSelect").value;
        const tbody = document.querySelector("#tablaResumenSector tbody");
        tbody.innerHTML = "";
        lineItemsSector.forEach(item => {
          let importeFinal = "";
          if(moneda === "ARS") {
            importeFinal = `$ ${item.finalArs.toFixed(2)}`;
          } else if(moneda === "USD") {
            importeFinal = `U$D ${item.finalUsd.toFixed(2)}`;
          } else {
            importeFinal = `$ ${item.finalArs.toFixed(2)} / U$D ${item.finalUsd.toFixed(2)}`;
          }
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.sector}</td>
            <td>${item.descripcion}</td>
            <td>${item.tipoVidrio}</td>
            <td>${item.instalacion}</td>
            <td>${item.lamina}</td>
            <td>${importeFinal}</td>
          `;
          tbody.appendChild(row);
        });
      }
      
      document.getElementById("secMonedaSelect").addEventListener("change", updateTablaResumenSector);
      
      /********* Pantallas de selección *********/
      document.getElementById("btnPresupuestoGeneral").addEventListener("click", function() {
        document.getElementById("landingPage").style.display = "none";
        document.getElementById("formGeneral").style.display = "block";
        genCurrentStep = 1;
        showStep('gen', genCurrentStep);
      });
      document.getElementById("btnPresupuestoSector").addEventListener("click", function() {
        document.getElementById("landingPage").style.display = "none";
        document.getElementById("formSector").style.display = "block";
        secCurrentStep = 1;
        showStep('sec', secCurrentStep);
      });
      
      /********* Envío (Simulación) *********/
      document.getElementById("wizardGeneral").addEventListener("submit", function(e) {
        e.preventDefault();
        alert("Presupuesto General guardado y enviado (simulación)!");
      });
      document.getElementById("wizardSector").addEventListener("submit", function(e) {
        e.preventDefault();
        alert("Presupuesto por Sector guardado y enviado (simulación)!");
      });
      
      /********* Inicializar steps *********/
      showStep('gen', genCurrentStep);
      showStep('sec', secCurrentStep);
      
      // Mostrar/Ocultar Días a más de 200km según check
      const genInterior = document.getElementById("genInterior");
      const costoInterior = document.getElementById("costoInterior");
      if (genInterior && costoInterior) {
        costoInterior.style.display = genInterior.checked ? "block" : "none";
        genInterior.addEventListener("change", function() {
          costoInterior.style.display = this.checked ? "block" : "none";
        });
      }
      const secInterior = document.getElementById("secInterior");
      const costoInteriorSector = document.getElementById("costoInteriorSector");
      if (secInterior && costoInteriorSector) {
        costoInteriorSector.style.display = secInterior.checked ? "block" : "none";
        secInterior.addEventListener("change", function() {
          costoInteriorSector.style.display = this.checked ? "block" : "none";
        });
      }
      
      /********* Función para exportar a PDF *********/
      function exportToPDF() {
        window.print();
      }
      window.exportToPDF = exportToPDF;
      
      /********* Exponer funciones globalmente *********/
      window.showStep = showStep;
      window.nextStep = nextStep;
      window.prevStep = prevStep;
      window.addLaminaGeneral = addLaminaGeneral;
      window.addMedidaGeneral = addMedidaGeneral;
      window.calcularTotalesGeneral = calcularTotalesGeneral;
      window.addSector = addSector;
      window.addLaminaInSector = addLaminaInSector;
      window.addMedidaInSector = addMedidaInSector;
      window.calcularTotalesSector = calcularTotalesSector;
    });
  </script>
</body>
</html>
